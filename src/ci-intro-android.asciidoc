=  Introduction to Continuous Integration Server Usage Focusing on Android Development 
:author:    Manfred Moser, simpligility technologies inc.
:backend:   slidy
:max-width: 45em
:data-uri:
:icons:
:toc!:
:slidetitleindentcar: 
:copyright: Copyright 2013, simpligility technologies inc., All Rights Reserved.


== About Manfred Moser

* Long time CI user and administrator

* Author of http://wiki.eclipse.org/The_Hudson_Book[The Hudson Book]

* Open source project lead https://code.google.com/p/ksoap2-android/[ksoap2-android], https://code.google.com/p/maven-android-plugin/[Android Maven Plugin]

* Presenter at various conferences AnDevCon, OSCON, JUC, ... 

* Founder of http://www.mosabuam.com/vijug/blog/[VIJUG] and https://plus.google.com/112826376355061333205/posts[GDG Victoria BC]

* Owner http://www.simpligility.com[simpligility technologies inc.]

== Objectives

* Understand the benefits of using a continuous integration

* Consider the options for deployment

* Glance at different available CI servers and services

* Get started

* Android specific considerations


== What is a CI server? 

[quote, Anonymous System Administrator]
A CI server is nothing special - it is just CRON with a user interface.

== What is a CI server? 

[quote, Anonymous Developer]
A relentless worker - another member of my team, that works for ME!

== What is a CI server? 

[quote, Anonymous System Administrator] 
Just a server running your builds.

== What is a CI server? 

[quote, Anonymous QA developer]
A great tool saving me from having to run all the tests manually.

== What is a CI server? 

[quote, Anonymous QA Manager]
A communication tool for the development and QA teams and beyond.

== What is a CI server? - really now!

[quote, Manfred Moser] 
Everything mentioned so far and more! A CI
server/cluster is a central piece of your development
infrastructure. Once you got used to having a CI server, you will never look back.


== What is Continuous Integration?

A *software development* practice

that evolved in the 
http://www.extremeprogramming.org/[Extreme Programming (XP)] 
community 

starting *about 1999*

and first mentioned by Martin Fowler and Kent Beck.


== What is Continuous Integration? 

[quote, Martin Fowler]
Continuous Integration is a software development practice where
members of a team integrate their work frequently, usually each person
integrates at least daily - leading to multiple integrations
per day. Each integration is verified by an automated build (including
test) to detect integration errors as quickly as possible. Many teams
find that this approach leads to significantly reduced integration
problems and allows a team to develop cohesive software more rapidly. 

Full article is on
http://www.martinfowler.com/articles/continuousIntegration.html[Martin
Fowlers web site]

== Practices of Continuous Integration - Part 1

According to Martin Fowler...

* Maintain a Single Source Repository

* Automate the Build

* Make Your Build Self-Testing

* Everyone Commits to the Mainline Every Day

* Every Commit Should Build the Mainline on an Integration Machine

== Practices of Continuous Integration - Part 1

* Keep the Build Fast

* Test in a Clone of the Production Environment

* Make it Easy for Anyone to Get the Latest Executable

* Everyone can see what's happening

* Automate Deployment

IMPORTANT: This should give you a good idea about what to AIM for! Let's discuss
this in detail...

== Continuous Delivery

Continuous integration taken to the next level::

* software is always in a state suitable for production deployment

* and is deployed to production regularly (e.g. daily or more often)

== Core Features of Continuous Integration Platforms

* Version control system integration

* Scheduling

* Build tool and script integration

* Communication features

* Ideally expandability

== Benefits

* Reduces the need for developers and others to manually build
  software

* Reduces the risk of integrating features, since it is done all the
  time (no more release deadline crunch!) 

* Automates and codifies how software is built

* Enhances visibility and communication in development, QA and beyond

* Reduces the number of defects and raises quality of your software

== Use Cases Beyond Software Builds


There are a *lot* of different use cases for CI platforms beyond
build software applications, so expandability is key! 

* building and publishing a book or a website

* orchestrating home automation

* running backups


== Deployment Options - Operating Systems? 

For Android development you have many options, but ..

* Are you also building iOS apps? 

* Is the production environment for e.g. the backend servers running on Linux? 

* Do you need to verify it works on Windows?

-> you might have to use different ones

== Deployment Options - One or Many?

- One large server

- Cluster of one server with multiple smaller slaves

-> In most enterprises one server will not be sufficient

== Deployment Options - Hardware or VM?

Hardware::

* more hazzle to look after and get started

* allows you to attache physical devices

* sort of required for some build (e.g. iOS)

VM::

* easy to start and stop

* possible with different OS

* easier to scale


== Deployment Options - Provisioning?

How do I get all the tools needed to all the CI servers? 

* Tools built into CI servers (e.g. Maven download install in Hudson)

* VM's and VM snapshots

* Provisioning systems like https://puppetlabs.com/[Puppet] , 
  http://www.opscode.com/chef/[Chef] or http://cfengine.com/[CFEngine]

* Package management system of operating system directly (apt-get, yum...)

- Manual install on each machine .. painful after a while


image::images/puppet.png[scale=100]


image::images/chef.png[scale=100]


image::images/cfengine.png[scale=100]


== Deployment Options - Scalability?

on demand start up of VM




== Deployment Options

- computer under the desk in local network

- VM 

- VM in Cloud

- Mixture of 


== Different CI Servers

Lots of them available

- open source

- commercial

- SAAS


== Eclipse Hudson

image::images/hudson.png[scale=100]

http://www.hudson-ci.org

- Top level project of the Eclipse Foundation

- Backed by Oracle and used in their cloud offering

- Open source under the Eclipse Public License


== Jenkins

image::images/jenkins.png[scale=100]

http://www.jenkins-ci.org

- Open source and commercial version

- Backed by Cloudbees

- 

== Travis CI

image::images/travis.png[scale=100]

https://travis-ci.org

- SAAS

- Great github integraton

== Others CI Servers

image::images/bamboo.png[scale=100]

* http://www.atlassian.com/software/bamboo/overview[Atlassian Bamboo]

** great integration with other Atlassian products like JIRA

** good Amazon EC 2 support 

** self hosted or SAAS available

image::images/teamcity.png[scale=100]

* http://www.jetbrains.com/teamcity/[JetBrains TeamCity]

** from the makers of IntelliJ IDEA/Android Studio 

** integration with YouTrack

** free for up to 20 builds 

== Others CI Servers - continued

* http://msdn.microsoft.com/en-us/vstudio/ff637362.aspx[MS Team
  Foundation Server]

** don't know much about it, strong .Net and MS tooling focus

* http://cruisecontrol.sourceforge.net/[Cruise Control]

** old and outdated

* http://www.thoughtworks-studios.com/go-continuous-delivery[ThoughWorks
  Go]

** focus towards continuous delivery

** community edition

* ...

NOTE: There are many more available, often as part of enterprise tools
under the Application Lifecycle Management ALM term

== How to Select Your CI Server Platform

* consider your needs beyond Android application

* try them out, most have open source or free trial or community
  editions

* consider what other tools like issue trackers you already use

NOTE: There are a lot of choices available. Just check out this
http://confluence.public.thoughtworks.org/display/CC/CI+Feature+Matrix[comparison
matrix]. But don't worry too much just get started.. 

== Building Applications 

For continuous integration, build needs to happen on the command line!

You can build Android applications in a couple of ways... 

- Apache Ant

- Apache Maven

- Gradle

- Any of the above invoked from script

- make for NDK apps, combined with above

- Custom script 

WARNING: Be careful not to rely too much on the configuration in a
specific CI server, that makes switching or running build on other
machines more difficult. 

== Provisioning Android SDK

* via a script E.g. see Android Maven Plugin Samples configuration

* using VM snapshots

* manually (wont scale but possible to get started)




== Testing Applications

On the JVM::

* Plain unit tests

* Tests with mocked Android classes Robolectric


On Dalvik VM / Android::

* Integration/Instrumentation tests - Robotium


SDK Tools::

* Instrumentation tests

* MonkeyRunner

* Monkey

* UI Automator

NOTE: There are dedicated in the cloud test setups available,
e.g. http://testdroid.com/[TestDroid from Bitbar]


https://github.com/square/spoon



== Android Emulator 

One or multiple emulator or attached devices are needed for
instrumentation testing!

Devices::

* Need access to the hardware or host of VM

* Use a USB Hub

Emulator:: 

* Potentially easier to emulate lots of devices

* With hardware acceleration faster

TIP: Android Maven Plugin can run tests on all attached devices



== Analysis - Overview

There are *lots* of different tools available.

Java/Generic::

* Checkstyle

* PMD

* Findbugs

* Sonar

Android Specific::

* Lint



TIP:  Stephane Nicolas has a great sample project set up at https://github.com/stephanenicolas/Quality-Tools-for-Android


== Android Continuous Deployment

Internally:: 

* to a repository manager like Sonatype Nexus 

* QA and other users can access apk via http url

To stores::

* All have a web UI -> you can automate the upload with scripts,
  e.g. parameterized selenium script

* Ideally stores would have a management API - I talked to the Play
  Store team at Google IO, they want to get there, we need to push them!

WARNING: I strongly recommend to adapt the frequency of deployments
suitable to your users!

== More Links

* http://en.wikipedia.org/wiki/Continuous_integration[Wikipedia article about Continuous Integration]

* http://en.wikipedia.org/wiki/Continuous_delivery[Wikipedia article about Continuous Delivery]

== Summary

Continuous integration usage is easy and essential!

Get on with it!
